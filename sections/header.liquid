{% comment %}
  Header Section - La Hime
  Converts the React Navbar component to Shopify Liquid
{% endcomment %}

<nav id="shopify-section-header" class="fixed top-0 left-0 right-0 z-50 transition-all duration-300 ease-in-out header-nav" data-section-id="{{ section.id }}" data-section-type="header">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex justify-between items-center relative h-14">
    
    {%- comment -%} LEFT: Sidebar Trigger {%- endcomment -%}
    <button
      onclick="toggleSidebar()"
      class="p-2 text-black hover:text-pink-600 transition-colors bg-transparent relative z-20"
      aria-label="Open Menu"
    >
      <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="3" y1="12" x2="21" y2="12"></line>
        <line x1="3" y1="6" x2="21" y2="6"></line>
        <line x1="3" y1="18" x2="21" y2="18"></line>
      </svg>
    </button>

    {%- comment -%} CENTER: Logo {%- endcomment -%}
    <a href="/" class="absolute left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2 flex flex-col items-center justify-center transition-all duration-300 z-30 header-logo">
      <div class="relative flex flex-col items-center group cursor-pointer">
        {% if section.settings.logo %}
          <img
            src="{{ section.settings.logo | img_url: '240x' }}"
            alt="{{ shop.name }}"
            class="w-[120px] h-auto transition-transform duration-300 group-hover:scale-105"
            loading="eager"
          />
        {% else %}
          <span class="font-brand text-3xl">{{ shop.name }}</span>
        {% endif %}
      </div>
    </a>

    {%- comment -%} RIGHT: Icons & Search Bar {%- endcomment -%}
    <div class="flex items-center justify-end relative z-20 gap-1 md:gap-2">
      
      {%- comment -%} Search Icon {%- endcomment -%}
      <div class="relative flex items-center">
        <button onclick="toggleSearch()" class="transition-all bg-transparent p-2 cursor-pointer text-black hover:text-pink-600" aria-label="Search">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.35-4.35"></path>
          </svg>
        </button>
      </div>
      
      {%- comment -%} Wishlist Icon {%- endcomment -%}
      <a href="/pages/wishlist" class="relative hidden md:block text-black hover:text-pink-600 transition-transform hover:scale-110 bg-transparent p-2">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
        </svg>
        <span class="wishlist-count absolute top-0 right-0 bg-pink-500 text-white text-[10px] font-bold w-4 h-4 rounded-full flex items-center justify-center border border-white hidden">0</span>
      </a>
      
      {%- comment -%} Cart Icon {%- endcomment -%}
      <a href="/cart" onclick="openCartDrawer(event)" class="relative text-black hover:text-pink-600 transition-transform hover:scale-110 bg-transparent p-2" id="cart-icon-link">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path>
          <line x1="3" y1="6" x2="21" y2="6"></line>
          <path d="M16 10a4 4 0 0 1-8 0"></path>
        </svg>
        <span id="cart-count-bubble" class="absolute top-0 right-0 bg-pink-500 text-white text-[10px] font-bold w-4 h-4 rounded-full flex items-center justify-center border border-white {% if cart.item_count == 0 %}hidden{% endif %}">
          {{ cart.item_count }}
        </span>
      </a>

      {%- comment -%} Account Icon {%- endcomment -%}
      <a href="{% if customer %}{{ routes.account_url }}{% else %}{{ routes.account_login_url }}{% endif %}" class="relative text-black hover:text-pink-600 transition-transform hover:scale-110 bg-transparent p-2">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
          <circle cx="12" cy="7" r="4"></circle>
        </svg>
      </a>
    </div>
  </div>

  {%- comment -%} Search Bar Dropdown {%- endcomment -%}
  <div id="search-dropdown" class="absolute top-full left-0 right-0 bg-white border-t border-b border-pink-100 shadow-xl max-h-[70vh] overflow-y-auto hidden">
    <div class="max-w-7xl mx-auto px-4 py-6">
      <form action="/search" method="get" class="mb-6">
        <div class="relative flex items-center bg-white rounded-full border border-pink-200 shadow-sm overflow-hidden h-12">
          <input
            type="text"
            name="q"
            id="search-input"
            placeholder="Search..."
            autocomplete="off"
            class="w-full px-6 py-3 outline-none text-sm font-medium bg-transparent text-gray-800 placeholder:text-gray-400"
          />
          <button type="submit" class="pr-4 text-gray-600 hover:text-black">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="11" cy="11" r="8"></circle>
              <path d="m21 21-4.35-4.35"></path>
            </svg>
          </button>
        </div>
      </form>
      <div id="search-results"></div>
    </div>
  </div>
</nav>

{%- comment -%} Mobile Sidebar Navigation {%- endcomment -%}
<div id="sidebar-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden" onclick="toggleSidebar()"></div>
<div id="sidebar" class="fixed left-0 top-0 h-full w-80 bg-white z-50 transform -translate-x-full transition-transform duration-300 shadow-2xl overflow-y-auto">
  <div class="p-6">
    <div class="flex justify-between items-center mb-8">
      <h2 class="font-brand text-2xl">Menu</h2>
      <button onclick="toggleSidebar()" class="p-2 hover:bg-gray-100 rounded-full">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>
    
    <nav class="space-y-2">
      {% for link in linklists.main-menu.links %}
        {% unless link.title == 'Catalogo' %}
          <a href="{{ link.url }}" class="block px-4 py-3 rounded-xl text-gray-600 hover:bg-gray-50 hover:text-pink-600 transition-colors font-medium">
            {{ link.title }}
          </a>
        {% endunless %}
      {% endfor %}
      
      <a href="/collections/all" class="block px-4 py-3 rounded-xl text-gray-600 hover:bg-gray-50 hover:text-pink-600 transition-colors font-medium">Shop</a>
      <a href="/pages/about" class="block px-4 py-3 rounded-xl text-gray-600 hover:bg-gray-50 hover:text-pink-600 transition-colors font-medium">About</a>
      <a href="/pages/contact" class="block px-4 py-3 rounded-xl text-gray-600 hover:bg-gray-50 hover:text-pink-600 transition-colors font-medium">Contact</a>
    </nav>
  </div>
</div>

<script>
  // Scroll effect for header
  let lastScroll = 0;
  window.addEventListener('scroll', function() {
    const header = document.querySelector('.header-nav');
    const currentScroll = window.pageYOffset;
    
    if (currentScroll > 20) {
      header.classList.add('bg-white/80', 'backdrop-blur-md', 'border-b', 'border-pink-100', 'py-2', 'shadow-sm');
      header.classList.remove('bg-transparent', 'py-4');
    } else {
      header.classList.remove('bg-white/80', 'backdrop-blur-md', 'border-b', 'border-pink-100', 'py-2', 'shadow-sm');
      header.classList.add('bg-transparent', 'py-4');
    }
    
    lastScroll = currentScroll;
  });

  // Sidebar toggle
  function toggleSidebar() {
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('sidebar-overlay');
    
    sidebar.classList.toggle('-translate-x-full');
    overlay.classList.toggle('hidden');
    document.body.classList.toggle('overflow-hidden');
  }

  // Search toggle
  function toggleSearch() {
    const searchDropdown = document.getElementById('search-dropdown');
    const searchInput = document.getElementById('search-input');
    
    searchDropdown.classList.toggle('hidden');
    
    if (!searchDropdown.classList.contains('hidden')) {
      setTimeout(() => searchInput.focus(), 100);
    }
  }

  // Close search when clicking outside
  document.addEventListener('click', function(event) {
    const searchDropdown = document.getElementById('search-dropdown');
    const target = event.target;
    
    if (!searchDropdown.contains(target) && !target.closest('[onclick="toggleSearch()"]')) {
      searchDropdown.classList.add('hidden');
    }
  });
</script>

{% schema %}
{
  "name": "Header",
  "settings": [
    {
      "type": "image_picker",
      "id": "logo",
      "label": "Logo Image"
    },
    {
      "type": "link_list",
      "id": "menu",
      "label": "Menu",
      "default": "main-menu"
    }
  ]
}
{% endschema %}
