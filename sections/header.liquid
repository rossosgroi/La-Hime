{% comment %}
  Header Section - Navigation with search, wishlist, cart, and account links
  Responsive desktop/mobile with proper z-index layering
{% endcomment %}

<header id="shopify-section-header" class="fixed top-0 left-0 right-0 z-40 bg-white/80 backdrop-blur-md border-b border-gray-100 transition-all duration-300 header-nav">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex justify-between items-center h-16 relative">
      
      {%- comment -%} LEFT: Menu Button (Mobile/Desktop) {%- endcomment -%}
      <button
        id="menu-toggle"
        onclick="toggleSidebar()"
        class="p-2 text-black hover:text-pink-600 transition-colors bg-transparent z-20"
        aria-label="Open Menu"
      >
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="3" y1="12" x2="21" y2="12"></line>
          <line x1="3" y1="6" x2="21" y2="6"></line>
          <line x1="3" y1="18" x2="21" y2="18"></line>
        </svg>
      </button>

      {%- comment -%} CENTER: Logo {%- endcomment -%}
      <a href="/" class="absolute left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2 flex items-center justify-center z-30 transition-transform hover:scale-105">
        <img
          src="https://cdn.shopify.com/s/files/1/0746/8445/4149/files/logo.png"
          alt="{{ shop.name }}"
          class="h-12 w-auto"
          loading="eager"
        />
      </a>

      {%- comment -%} RIGHT: Search, Wishlist, Cart, Account {%- endcomment -%}
      <div class="flex items-center justify-end gap-2 z-20">
        
        {%- comment -%} Search Button {%- endcomment -%}
        <button 
          onclick="openSearchModal()" 
          class="p-2.5 text-black hover:text-pink-600 transition-colors rounded-full hover:bg-gray-50"
          aria-label="Search"
          title="Search (⌘K)"
        >
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.35-4.35"></path>
          </svg>
        </button>
        
        {%- comment -%} Wishlist Button (Desktop Only) {%- endcomment -%}
        <button 
          onclick="openWishlistDrawer()" 
          class="hidden md:flex p-2.5 text-black hover:text-pink-600 transition-colors rounded-full hover:bg-gray-50 relative"
          aria-label="Wishlist"
        >
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
          </svg>
          <span class="wishlist-count absolute -top-1 -right-1 bg-pink-500 text-white text-xs font-bold w-5 h-5 rounded-full flex items-center justify-center hidden">0</span>
        </button>
        
        {%- comment -%} Cart Button {%- endcomment -%}
        <button 
          onclick="openCartDrawer(event)" 
          class="p-2.5 text-black hover:text-pink-600 transition-colors rounded-full hover:bg-gray-50 relative"
          aria-label="Cart"
        >
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="9" cy="21" r="1"></circle>
            <circle cx="20" cy="21" r="1"></circle>
            <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
          </svg>
          <span id="cart-count-bubble" class="absolute -top-1 -right-1 bg-pink-500 text-white text-xs font-bold w-5 h-5 rounded-full flex items-center justify-center {% if cart.item_count == 0 %}hidden{% endif %}">
            {{ cart.item_count }}
          </span>
        </button>

        {%- comment -%} Account Button {%- endcomment -%}
        <a 
          href="{% if customer %}{{ routes.account_url }}{% else %}{{ routes.account_login_url }}{% endif %}" 
          class="p-2.5 text-black hover:text-pink-600 transition-colors rounded-full hover:bg-gray-50"
          aria-label="Account"
        >
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
            <circle cx="12" cy="7" r="4"></circle>
          </svg>
        </a>
      </div>
    </div>
  </div>

  {%- comment -%} Search Modal {%- endcomment -%}
  <div id="search-modal" class="hidden fixed inset-0 bg-black/50 z-50 flex items-start justify-center pt-20">
    <div class="w-full max-w-2xl mx-auto px-4" onclick="event.stopPropagation()">
      <form action="/search" method="get" class="relative">
        <div class="relative flex items-center bg-white rounded-lg shadow-lg overflow-hidden">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="absolute left-4 text-gray-400">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.35-4.35"></path>
          </svg>
          <input
            type="search"
            name="q"
            id="search-modal-input"
            placeholder="Search products..."
            autocomplete="off"
            class="w-full pl-12 pr-4 py-4 outline-none text-lg bg-white text-gray-900 placeholder:text-gray-400"
          />
          <button 
            type="submit" 
            class="pr-4 text-gray-400 hover:text-gray-900 transition-colors"
            aria-label="Search"
          >
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M6 18L18 6M18 18L6 6"/>
            </svg>
          </button>
        </div>
      </form>
      
      {%- comment -%} Search Suggestions {%- endcomment -%}
      <div class="mt-4 bg-white rounded-lg shadow-lg p-6">
        <p class="text-sm text-gray-500 uppercase tracking-wider mb-4">Popular searches</p>
        <div class="flex flex-wrap gap-2">
          <a href="/search?q=dresses" class="px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm hover:bg-pink-100 hover:text-pink-700 transition-colors">Dresses</a>
          <a href="/search?q=tops" class="px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm hover:bg-pink-100 hover:text-pink-700 transition-colors">Tops</a>
          <a href="/search?q=skirts" class="px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm hover:bg-pink-100 hover:text-pink-700 transition-colors">Skirts</a>
          <a href="/search?q=accessories" class="px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm hover:bg-pink-100 hover:text-pink-700 transition-colors">Accessories</a>
        </div>
      </div>
    </div>
  </div>
</header>

{%- comment -%} Mobile Sidebar Navigation {%- endcomment -%}
<div id="sidebar-overlay" class="fixed inset-0 bg-black/50 z-30 hidden transition-opacity duration-300" onclick="toggleSidebar()" aria-hidden="true"></div>
<nav id="sidebar" class="fixed left-0 top-0 h-screen w-72 bg-white z-40 transform -translate-x-full transition-transform duration-300 shadow-2xl overflow-y-auto">
  <div class="p-6">
    {%- comment -%} Sidebar Header {%- endcomment -%}
    <div class="flex justify-between items-center mb-8">
      <img
        src="https://cdn.shopify.com/s/files/1/0746/8445/4149/files/logo.png"
        alt="{{ shop.name }}"
        class="h-10 w-auto"
      />
      <button 
        onclick="toggleSidebar()" 
        class="p-2 hover:bg-gray-100 rounded-full transition-colors"
        aria-label="Close menu"
      >
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>
    
    {%- comment -%} Sidebar Navigation Links {%- endcomment -%}
    <nav class="space-y-1 mb-8">
      <a href="/collections/all" class="block px-4 py-3 rounded-lg text-gray-700 hover:bg-pink-50 hover:text-pink-600 transition-colors font-medium">
        Shop
      </a>
      <a href="/pages/about" class="block px-4 py-3 rounded-lg text-gray-700 hover:bg-pink-50 hover:text-pink-600 transition-colors font-medium">
        About
      </a>
      <a href="/pages/contact" class="block px-4 py-3 rounded-lg text-gray-700 hover:bg-pink-50 hover:text-pink-600 transition-colors font-medium">
        Contact
      </a>
      {% for link in linklists.main-menu.links %}
        <a href="{{ link.url }}" class="block px-4 py-3 rounded-lg text-gray-700 hover:bg-pink-50 hover:text-pink-600 transition-colors font-medium">
          {{ link.title }}
        </a>
      {% endfor %}
    </nav>

    {%- comment -%} Sidebar Footer {%- endcomment -%}
    <div class="border-t border-gray-200 pt-6 space-y-2">
      <a 
        href="{% if customer %}{{ routes.account_url }}{% else %}{{ routes.account_login_url }}{% endif %}" 
        class="block px-4 py-3 rounded-lg text-gray-700 hover:bg-pink-50 hover:text-pink-600 transition-colors font-medium"
      >
        {% if customer %}My Account{% else %}Sign In{% endif %}
      </a>
      <button 
        onclick="openWishlistDrawer(); toggleSidebar();" 
        class="w-full text-left px-4 py-3 rounded-lg text-gray-700 hover:bg-pink-50 hover:text-pink-600 transition-colors font-medium"
      >
        Wishlist
      </button>
    </div>
  </div>
</nav>

<script>
  // Sidebar toggle
  function toggleSidebar() {
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('sidebar-overlay');
    
    sidebar.classList.toggle('-translate-x-full');
    overlay.classList.toggle('hidden');
    document.body.classList.toggle('overflow-hidden');
  }

  // Close sidebar when pressing ESC
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
      const sidebar = document.getElementById('sidebar');
      if (!sidebar.classList.contains('-translate-x-full')) {
        toggleSidebar();
      }
    }
  });

  // Close sidebar when clicking links
  document.querySelectorAll('#sidebar a').forEach(link => {
    link.addEventListener('click', function() {
      // Don't close for account links as they navigate away
      const href = this.getAttribute('href');
      if (!href.includes('/account') && !href.includes('/login')) {
        toggleSidebar();
      }
    });
  });
</script>

<style>
  .font-serif-display { font-family: 'Playfair Display', serif; }
  
  /* Smooth transitions */
  #sidebar {
    will-change: transform;
  }
  
  #sidebar-overlay {
    opacity: 1;
  }
  
  #sidebar-overlay.hidden {
    display: none;
    opacity: 0;
  }
</style>

{% schema %}
{
  "name": "Header",
  "settings": [
    {
      "type": "image_picker",
      "id": "logo",
      "label": "Logo Image",
      "info": "Recommended size: 240px × 60px"
    },
    {
      "type": "link_list",
      "id": "menu",
      "label": "Menu",
      "default": "main-menu"
    }
  ]
}
{% endschema %}
