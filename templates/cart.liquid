{% comment %}
  Cart Template - La Hime
  Converts the React Cart page to Shopify Liquid
{% endcomment %}

<div class="pt-32 pb-24 min-h-screen bg-stone-50">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <h1 class="font-serif-display text-4xl mb-8 text-gray-900">Shopping Bag</h1>

    {% if cart.item_count == 0 %}
      <div class="text-center py-20 bg-white rounded-2xl shadow-sm">
        <h2 class="text-2xl font-bold text-gray-900 mb-4">Your bag is empty</h2>
        <p class="text-gray-500 mb-8">Looks like you haven't added anything yet.</p>
        <a href="/collections/all" class="inline-block bg-black text-white px-8 py-3 rounded-full font-bold uppercase tracking-wider hover:bg-pink-500 transition-colors">
          Start Shopping
        </a>
      </div>
    {% else %}
      <form action="/cart" method="post" novalidate>
        <div class="flex flex-col lg:flex-row gap-12">
          
          {%- comment -%} Cart Items {%- endcomment -%}
          <div class="flex-1 space-y-6">
            {% for item in cart.items %}
              <div class="bg-white p-6 rounded-2xl shadow-sm flex gap-6 items-center" data-line-item-key="{{ item.key }}">
                <a href="{{ item.url }}" class="w-24 h-24 flex-shrink-0 bg-gray-100 rounded-lg overflow-hidden block">
                  {% if item.image %}
                    <img src="{{ item.image | img_url: '200x' }}" alt="{{ item.title | escape }}" class="w-full h-full object-cover hover:scale-110 transition-transform duration-500" />
                  {% endif %}
                </a>
                
                <div class="flex-1">
                  <div class="flex justify-between items-start mb-2">
                    <a href="{{ item.url }}">
                      <h3 class="font-bold text-gray-900 font-serif-display text-lg hover:text-pink-600 transition-colors">{{ item.product.title }}</h3>
                    </a>
                    <p class="font-mono font-medium text-gray-900">{{ item.final_line_price | money }}</p>
                  </div>
                  
                  {% unless item.variant.title == 'Default Title' %}
                    <p class="text-sm text-gray-500 mb-4">{{ item.variant.title }}</p>
                  {% endunless %}
                  
                  <div class="flex justify-between items-center">
                    <div class="flex items-center border border-gray-200 rounded-full">
                      <button 
                        type="button"
                        onclick="updateQuantity('{{ item.key }}', {{ item.quantity | minus: 1 }})"
                        class="p-2 hover:bg-gray-50 rounded-full transition-colors text-gray-600"
                        {% if item.quantity <= 1 %}disabled{% endif %}
                      >
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                          <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                      </button>
                      <span class="w-8 text-center text-sm font-bold text-gray-900">{{ item.quantity }}</span>
                      <button 
                        type="button"
                        onclick="updateQuantity('{{ item.key }}', {{ item.quantity | plus: 1 }})"
                        class="p-2 hover:bg-gray-50 rounded-full transition-colors text-gray-600"
                      >
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                          <line x1="12" y1="5" x2="12" y2="19"></line>
                          <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                      </button>
                    </div>
                    <a 
                      href="/cart/change?line={{ forloop.index }}&quantity=0"
                      class="text-gray-400 hover:text-red-500 transition-colors"
                    >
                      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="3 6 5 6 21 6"></polyline>
                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                      </svg>
                    </a>
                  </div>
                </div>
              </div>
            {% endfor %}
            
            <a href="/collections/all" class="inline-flex items-center gap-2 text-sm font-bold uppercase tracking-wider text-gray-500 hover:text-pink-600 transition-colors mt-4">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="rotate-180">
                <line x1="5" y1="12" x2="19" y2="12"></line>
                <polyline points="12 5 19 12 12 19"></polyline>
              </svg>
              Continue Shopping
            </a>
          </div>

          {%- comment -%} Summary {%- endcomment -%}
          <div class="lg:w-96 flex-shrink-0 h-fit">
            <div class="bg-white p-8 rounded-2xl shadow-sm border border-pink-100 sticky top-32">
              <h2 class="font-bold text-xl mb-6 font-serif-display text-gray-900">Order Summary</h2>
              
              <div class="space-y-4 mb-8 text-gray-600">
                <div class="flex justify-between">
                  <span>Subtotal</span>
                  <span>{{ cart.total_price | money }}</span>
                </div>
                <div class="flex justify-between">
                  <span>Shipping</span>
                  <span>Calculated at checkout</span>
                </div>
                <div class="flex justify-between font-bold text-black text-lg border-t border-gray-100 pt-4">
                  <span>Total</span>
                  <span>{{ cart.total_price | money }}</span>
                </div>
              </div>

              <button 
                type="submit"
                name="checkout"
                class="w-full bg-black text-white py-4 rounded-full font-bold uppercase tracking-widest hover:bg-pink-500 transition-all shadow-lg hover:shadow-pink-300/50 mb-4 flex items-center justify-center gap-2"
              >
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                  <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                </svg>
                Checkout
              </button>
              
              <div class="text-center text-xs text-gray-400">
                <p>Secure Checkout powered by Shopify</p>
              </div>
            </div>
          </div>

        </div>
      </form>
    {% endif %}
  </div>
</div>

<script>
  function updateQuantity(key, quantity) {
    fetch('/cart/change.js', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ id: key, quantity: quantity })
    })
    .then(response => response.json())
    .then(data => {
      location.reload();
    });
  }
</script>
