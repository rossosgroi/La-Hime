{% comment %}
  Collection/Shop Template - Product Listing with Filtering & Sorting
  Mirrors La Hime React Shop.tsx functionality
{% endcomment %}

<div class="pt-24 min-h-screen bg-stone-50">
  
  {%- comment -%} Collection Header {%- endcomment -%}
  <div class="bg-pink-50 border-b border-pink-100 py-12 mb-0">
    <div class="max-w-7xl mx-auto px-4 text-center">
      <h1 class="font-serif-display text-4xl md:text-5xl text-gray-900 mb-3">
        {{ collection.title }}
      </h1>
      <p class="text-gray-500">{{ collection.description | strip_html }}</p>
    </div>
  </div>

  {%- comment -%} Main Content Area {%- endcomment -%}
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-24 relative">
    
    {%- comment -%} Sticky Filter & Sort Bar {%- endcomment -%}
    <div class="sticky top-[64px] z-40 bg-stone-50/95 backdrop-blur-md border-b border-gray-200 py-4 mb-8 -mx-4 px-4 sm:mx-0 sm:px-0 sm:bg-transparent sm:backdrop-blur-none sm:static sm:border-b-0 sm:py-8 sm:mb-4">
      <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
        
        {%- comment -%} Filter Tags {%- endcomment -%}
        <div class="w-full md:w-auto">
          <div class="flex flex-wrap gap-2">
            
            {%- comment -%} All Button {%- endcomment -%}
            <a 
              href="{{ collection.url }}" 
              class="whitespace-nowrap px-5 py-2 rounded-full text-sm font-bold transition-all duration-300 border {% if collection.all_products_count == collection.products.size %}bg-black text-white border-black shadow-lg transform scale-105{% else %}bg-white text-gray-500 border-gray-200 hover:border-pink-300 hover:text-pink-500{% endif %}"
            >
              All
            </a>

            {%- comment -%} Tag Filters {%- endcomment -%}
            {% for tag in collection.all_tags %}
              {% if tag != blank %}
                <a 
                  href="{{ collection.url }}/{{ tag | handle }}" 
                  class="whitespace-nowrap px-5 py-2 rounded-full text-sm font-bold transition-all duration-300 border {% if current_tags contains tag %}bg-black text-white border-black shadow-lg transform scale-105{% else %}bg-white text-gray-500 border-gray-200 hover:border-pink-300 hover:text-pink-500{% endif %}"
                >
                  {{ tag }}
                </a>
              {% endif %}
            {% endfor %}
          </div>
        </div>

        {%- comment -%} Sort Dropdown {%- endcomment -%}
        <div class="relative w-full md:w-auto">
          <form method="get" class="inline">
            <select 
              name="sort_by" 
              onchange="this.form.submit()" 
              class="px-5 py-2 rounded-full text-sm font-bold border border-gray-200 bg-white text-gray-700 cursor-pointer hover:border-pink-300 transition-colors appearance-none pr-8"
              style="background-image: url('data:image/svg+xml;utf8,<svg fill=\"black\" height=\"24\" viewBox=\"0 0 24 24\" width=\"24\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M7 10l5 5 5-5z\"/></svg>'); background-repeat: no-repeat; background-position: right 8px center; background-size: 20px;"
            >
              <option value="best-selling" {% if sort_by == 'best-selling' %}selected{% endif %}>Best Selling</option>
              <option value="latest" {% if sort_by == 'latest' %}selected{% endif %}>Newest</option>
              <option value="price-ascending" {% if sort_by == 'price-ascending' %}selected{% endif %}>Price: Low to High</option>
              <option value="price-descending" {% if sort_by == 'price-descending' %}selected{% endif %}>Price: High to Low</option>
              <option value="title-ascending" {% if sort_by == 'title-ascending' %}selected{% endif %}>A - Z</option>
              <option value="title-descending" {% if sort_by == 'title-descending' %}selected{% endif %}>Z - A</option>
            </select>
          </form>
        </div>
      </div>
    </div>

    {%- comment -%} Products Grid {%- endcomment -%}
    {% if collection.products.size > 0 %}
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 lg:gap-8">
        {% for product in collection.products %}
          <div class="group relative transition-all duration-300">
            <a href="{{ product.url }}" class="block">
              
              {%- comment -%} Product Card Container {%- endcomment -%}
              <div class="relative aspect-[3/4] overflow-hidden bg-white p-3 shadow-sm transition-all duration-500 group-hover:shadow-xl group-hover:rotate-1 group-hover:scale-[1.02] border border-gray-100 rounded-lg">
                
                {%- comment -%} Badge {%- endcomment -%}
                {% if product.featured_image %}
                  {% if product.tags contains 'new' %}
                    <span class="absolute top-4 left-4 z-20 bg-black text-white text-xs font-bold px-3 py-1 rounded-full uppercase shadow-md">
                      New
                    </span>
                  {% endif %}
                  {% if product.tags contains 'sale' %}
                    <span class="absolute top-4 left-4 z-20 bg-pink-500 text-white text-xs font-bold px-3 py-1 rounded-full uppercase shadow-md">
                      Sale
                    </span>
                  {% endif %}
                {% endif %}

                {%- comment -%} Images with Hover Effect {%- endcomment -%}
                <div class="relative h-full w-full overflow-hidden bg-gray-100 rounded-lg">
                  <img
                    src="{{ product.featured_image | image_url: width: 400, height: 550 }}"
                    alt="{{ product.title }}"
                    class="absolute inset-0 h-full w-full object-cover transition-opacity duration-500 group-hover:opacity-0"
                    loading="lazy"
                  />
                  
                  {%- comment -%} Hover Image (if available) {%- endcomment -%}
                  {% if product.images.size > 1 %}
                    <img
                      src="{{ product.images[1] | image_url: width: 400, height: 550 }}"
                      alt="{{ product.title }} detail"
                      class="absolute inset-0 h-full w-full object-cover opacity-0 transition-opacity duration-500 group-hover:opacity-100"
                      loading="lazy"
                    />
                  {% endif %}

                  {%- comment -%} Quick Actions Overlay {%- endcomment -%}
                  <div class="absolute inset-x-0 bottom-0 p-4 opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex justify-center space-x-3 z-20">
                    
                    {%- comment -%} Add to Wishlist {%- endcomment -%}
                    <button 
                      class="wishlist-toggle p-3 rounded-full transition-colors shadow-lg bg-white/90 backdrop-blur-sm text-gray-900 hover:bg-pink-500 hover:text-white"
                      data-product-id="{{ product.id }}"
                      data-product-title="{{ product.title }}"
                      aria-label="Add to wishlist"
                    >
                      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                      </svg>
                    </button>
                    
                    {%- comment -%} Quick Add to Cart {%- endcomment -%}
                    <form action="/cart/add" method="post" class="inline">
                      <input type="hidden" name="id" value="{{ product.variants.first.id }}">
                      <button 
                        type="submit" 
                        class="bg-white/90 backdrop-blur-sm p-3 rounded-full text-gray-900 hover:bg-black hover:text-white transition-colors shadow-lg"
                        aria-label="Add to cart"
                      >
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                          <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path>
                          <line x1="3" y1="6" x2="21" y2="6"></line>
                          <path d="M16 10a4 4 0 0 1-8 0"></path>
                        </svg>
                      </button>
                    </form>
                  </div>
                </div>
              </div>
            </a>

            {%- comment -%} Product Info {%- endcomment -%}
            <div class="pt-4 pb-2 text-center">
              <h3 class="font-serif-display text-lg text-gray-900 group-hover:text-pink-600 transition-colors truncate px-2">
                {{ product.title }}
              </h3>
              
              {%- comment -%} Price {%- endcomment -%}
              <p class="font-mono text-sm text-gray-500 mt-1">
                {% if product.price_varies %}
                  from {{ product.price_min | money }}
                {% elsif product.compare_at_price %}
                  <span class="line-through">{{ product.compare_at_price | money }}</span>
                  {{ product.price | money }}
                {% else %}
                  {{ product.price | money }}
                {% endif %}
              </p>

              {%- comment -%} Quick Rating (if using reviews app) {%- endcomment -%}
              {% if product.metafields.reviews.rating.value %}
                <div class="mt-2 flex justify-center items-center gap-1">
                  <span class="text-yellow-400">★</span>
                  <span class="text-xs text-gray-500">{{ product.metafields.reviews.rating.value }}</span>
                </div>
              {% endif %}
            </div>
          </div>
        {% endfor %}
      </div>

      {%- comment -%} Pagination {%- endcomment -%}
      {% if paginate.pages > 1 %}
        <div class="mt-16 flex justify-center items-center gap-2">
          {% if paginate.previous %}
            <a 
              href="{{ paginate.previous.url }}" 
              class="px-4 py-2 border border-gray-200 rounded-lg hover:border-pink-500 transition-colors"
            >
              ← Previous
            </a>
          {% endif %}

          {% for part in paginate.parts %}
            {% if part.is_link %}
              <a 
                href="{{ part.url }}" 
                class="px-4 py-2 border border-gray-200 rounded-lg hover:border-pink-500 transition-colors"
              >
                {{ part.title }}
              </a>
            {% else %}
              <span class="px-4 py-2 border border-black bg-black text-white rounded-lg font-bold">
                {{ part.title }}
              </span>
            {% endif %}
          {% endfor %}

          {% if paginate.next %}
            <a 
              href="{{ paginate.next.url }}" 
              class="px-4 py-2 border border-gray-200 rounded-lg hover:border-pink-500 transition-colors"
            >
              Next →
            </a>
          {% endif %}
        </div>
      {% endif %}

    {% else %}
      {%- comment -%} Empty Collection {%- endcomment -%}
      <div class="text-center py-24">
        <p class="text-gray-500 text-lg mb-6">No products found in this collection.</p>
        <a 
          href="/collections/all" 
          class="inline-block px-8 py-3 bg-black text-white rounded-full font-bold hover:bg-pink-500 transition-colors"
        >
          Browse All Products
        </a>
      </div>
    {% endif %}
  </div>
</div>

<style>
  .font-serif-display {
    font-family: 'Playfair Display', serif;
  }
  
  .font-mono {
    font-family: 'Courier New', monospace;
  }
</style>

{% paginate collection.products by 24 %}{% endpaginate %}
