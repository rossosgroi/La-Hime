{% comment %}
  Collection Template - La Hime Shop Page
  Converts the React Shop page to Shopify Liquid
{% endcomment %}

<div class="pt-24 min-h-screen bg-stone-50">
  
  {%- comment -%} Header {%- endcomment -%}
  <div class="bg-pink-50 border-b border-pink-100 py-12 mb-8 w-full">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <h1 class="font-serif-display text-4xl md:text-5xl text-gray-900 mb-3">
        {% if collection.title %}
          {{ collection.title }}
        {% else %}
          All Collections
        {% endif %}
      </h1>
      <p class="text-gray-500">Find your new obsession.</p>
    </div>
  </div>

  {%- comment -%} Main Content Area {%- endcomment -%}
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-24 relative">
    
    {%- comment -%} Sticky Filter Bar {%- endcomment -%}
    <div class="sticky top-[64px] z-40 bg-stone-50/95 backdrop-blur-md border-b border-gray-200 py-4 mb-8 -mx-4 px-4 sm:mx-0 sm:px-0 sm:bg-transparent sm:backdrop-blur-none sm:static sm:border-b-0 sm:py-8 sm:mb-4">
      <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
        
        {%- comment -%} Filter by Product Type/Tags {%- endcomment -%}
        <div class="w-full md:w-auto overflow-x-auto no-scrollbar">
          <div class="flex items-center gap-2" id="collection-filters">
            <a href="{{ collection.url }}" class="filter-btn whitespace-nowrap px-5 py-2 rounded-full text-sm font-bold transition-all duration-300 border {% if current_tags.size == 0 %}bg-black text-white border-black shadow-lg transform scale-105{% else %}bg-white text-gray-500 border-gray-200 hover:border-pink-300 hover:text-pink-500{% endif %}">
              All
            </a>
            {% for tag in collection.all_tags %}
              {% unless tag contains '_' %}
                <a href="{{ collection.url }}/{{ tag | handle }}" class="filter-btn whitespace-nowrap px-5 py-2 rounded-full text-sm font-bold transition-all duration-300 border {% if current_tags contains tag %}bg-black text-white border-black shadow-lg transform scale-105{% else %}bg-white text-gray-500 border-gray-200 hover:border-pink-300 hover:text-pink-500{% endif %}">
                  {{ tag }}
                </a>
              {% endunless %}
            {% endfor %}
          </div>
        </div>

        {%- comment -%} Sort & Stats {%- endcomment -%}
        <div class="w-full md:w-auto flex justify-between md:justify-end items-center gap-4 border-t md:border-t-0 border-gray-200 pt-3 md:pt-0">
          <span class="text-sm text-gray-400 font-medium">
            {{ collection.products.size }} Results
          </span>
          
          <div class="relative group">
            <select 
              id="SortBy"
              class="appearance-none bg-white border border-gray-200 rounded-full pl-5 pr-10 py-2 text-sm font-bold text-gray-900 focus:outline-none focus:border-black cursor-pointer shadow-sm hover:shadow-md transition-shadow"
              onchange="window.location.href = this.value"
            >
              {% assign sort_by = collection.sort_by | default: collection.default_sort_by %}
              <option value="{{ collection.url }}?sort_by=manual" {% if sort_by == 'manual' %}selected{% endif %}>Featured</option>
              <option value="{{ collection.url }}?sort_by=best-selling" {% if sort_by == 'best-selling' %}selected{% endif %}>Best Selling</option>
              <option value="{{ collection.url }}?sort_by=title-ascending" {% if sort_by == 'title-ascending' %}selected{% endif %}>A-Z</option>
              <option value="{{ collection.url }}?sort_by=title-descending" {% if sort_by == 'title-descending' %}selected{% endif %}>Z-A</option>
              <option value="{{ collection.url }}?sort_by=price-ascending" {% if sort_by == 'price-ascending' %}selected{% endif %}>Price: Low to High</option>
              <option value="{{ collection.url }}?sort_by=price-descending" {% if sort_by == 'price-descending' %}selected{% endif %}>Price: High to Low</option>
              <option value="{{ collection.url }}?sort_by=created-descending" {% if sort_by == 'created-descending' %}selected{% endif %}>Newest</option>
            </select>
          </div>
        </div>
      </div>
    </div>

    {%- comment -%} Product Grid {%- endcomment -%}
    <div class="min-h-[400px]">
      {% paginate collection.products by 12 %}
        {% if collection.products.size > 0 %}
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-x-6 gap-y-12">
            {% for product in collection.products %}
              {% render 'product-card', product: product %}
            {% endfor %}
          </div>

          {%- comment -%} Pagination {%- endcomment -%}
          {% if paginate.pages > 1 %}
            <div class="mt-16 flex justify-center items-center gap-2">
              {% if paginate.previous %}
                <a href="{{ paginate.previous.url }}" class="px-4 py-2 rounded-full border border-gray-300 text-gray-900 hover:bg-black hover:text-white transition-all">
                  ← Previous
                </a>
              {% endif %}
              
              {% for part in paginate.parts %}
                {% if part.is_link %}
                  <a href="{{ part.url }}" class="w-10 h-10 flex items-center justify-center rounded-full border border-gray-300 text-gray-900 hover:bg-black hover:text-white transition-all font-bold">
                    {{ part.title }}
                  </a>
                {% else %}
                  <span class="w-10 h-10 flex items-center justify-center rounded-full bg-black text-white font-bold">
                    {{ part.title }}
                  </span>
                {% endif %}
              {% endfor %}
              
              {% if paginate.next %}
                <a href="{{ paginate.next.url }}" class="px-4 py-2 rounded-full border border-gray-300 text-gray-900 hover:bg-black hover:text-white transition-all">
                  Next →
                </a>
              {% endif %}
            </div>
          {% endif %}
        {% else %}
          <div class="text-center py-24 text-gray-400 flex flex-col items-center">
            <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="4" y1="21" x2="4" y2="14"></line>
                <line x1="4" y1="10" x2="4" y2="3"></line>
                <line x1="12" y1="21" x2="12" y2="12"></line>
                <line x1="12" y1="8" x2="12" y2="3"></line>
                <line x1="20" y1="21" x2="20" y2="16"></line>
                <line x1="20" y1="12" x2="20" y2="3"></line>
                <line x1="1" y1="14" x2="7" y2="14"></line>
                <line x1="9" y1="8" x2="15" y2="8"></line>
                <line x1="17" y1="16" x2="23" y2="16"></line>
              </svg>
            </div>
            <p class="text-xl font-serif-display text-gray-900 mb-2">No items found</p>
            <p class="text-sm text-gray-500 mb-6">Try adjusting your filters or category.</p>
            <a href="/collections/all" class="text-pink-600 font-bold underline hover:text-black transition-colors">
              View All Items
            </a>
          </div>
        {% endif %}
      {% endpaginate %}
    </div>
  </div>
</div>
