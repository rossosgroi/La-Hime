{% comment %}
  Product Card Snippet - La Hime
  Converts the React ProductCard component to Shopify Liquid
  
  Usage: {% render 'product-card', product: product %}
{% endcomment %}

{% assign product_url = product.url | within: collection %}
{% assign on_sale = false %}
{% if product.compare_at_price > product.price %}
  {% assign on_sale = true %}
{% endif %}

<div class="product-card group relative" data-product-id="{{ product.id }}">
  <a href="{{ product_url }}" class="block">
    <div class="relative aspect-[3/4] overflow-hidden bg-white p-3 shadow-sm transition-all duration-500 group-hover:shadow-xl group-hover:rotate-1 group-hover:scale-[1.02] border border-gray-100">
      <div class="relative h-full w-full overflow-hidden bg-gray-100">
        
        {%- comment -%} Badge {%- endcomment -%}
        {% if product.tags contains 'new' or product.tags contains 'New' %}
          <span class="absolute top-2 left-2 z-20 bg-black text-white text-xs font-bold px-2 py-1 uppercase tracking-wider">
            New
          </span>
        {% elsif on_sale %}
          <span class="absolute top-2 left-2 z-20 bg-pink-500 text-white text-xs font-bold px-2 py-1 uppercase tracking-wider">
            Sale
          </span>
        {% endif %}
        
        {%- comment -%} Product Images {%- endcomment -%}
        {% if product.featured_image %}
          <img
            src="{{ product.featured_image | img_url: '600x' }}"
            alt="{{ product.title | escape }}"
            class="absolute inset-0 h-full w-full object-cover transition-opacity duration-500 group-hover:opacity-0"
            loading="lazy"
          />
        {% endif %}
        
        {% if product.images[1] %}
          <img
            src="{{ product.images[1] | img_url: '600x' }}"
            alt="{{ product.title | escape }} detail"
            class="absolute inset-0 h-full w-full object-cover opacity-0 transition-opacity duration-500 group-hover:opacity-100"
            loading="lazy"
          />
        {% endif %}
        
        {%- comment -%} Quick Actions Overlay {%- endcomment -%}
        <div class="absolute inset-x-0 bottom-0 p-4 opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex justify-center space-x-3 z-20">
          <button 
            class="wishlist-btn p-3 rounded-full bg-white/90 backdrop-blur-sm text-gray-900 hover:bg-pink-500 hover:text-white transition-colors shadow-lg"
            onclick="toggleWishlist(event, {{ product.id }})"
            aria-label="Add to wishlist"
          >
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
            </svg>
          </button>
          <a
            href="{{ product_url }}"
            class="bg-white/90 backdrop-blur-sm p-3 rounded-full text-gray-900 hover:bg-black hover:text-white transition-colors shadow-lg"
            aria-label="View product"
          >
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path>
              <line x1="3" y1="6" x2="21" y2="6"></line>
              <path d="M16 10a4 4 0 0 1-8 0"></path>
            </svg>
          </a>
        </div>
      </div>
      
      {%- comment -%} Polaroid-style Bottom Text {%- endcomment -%}
      <div class="pt-4 pb-2 text-center">
        <h3 class="font-serif-display text-lg text-gray-900 group-hover:text-pink-600 transition-colors truncate px-2">
          {{ product.title }}
        </h3>
        <p class="font-mono text-sm text-gray-500 mt-1">
          {% if on_sale %}
            <span class="line-through text-gray-400">{{ product.compare_at_price | money }}</span>
            <span class="text-pink-600 font-bold">{{ product.price | money }}</span>
          {% else %}
            {{ product.price | money }}
          {% endif %}
        </p>
      </div>
    </div>
  </a>
</div>
